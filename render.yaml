services:
  - type: web
    name: pdf-translator-ai
    runtime: docker
    dockerfilePath: ./Dockerfile
    region: singapore
    plan: free
    branch: main
    
    # Health check
    healthCheckPath: /health
    
    envVars:
      - key: MOCK_TRANSLATION
        value: "true"
      - key: PORT
        value: "8000"
      - key: MAX_PAGES_LIMIT
        value: "20"  # REDUCED for free tier stability
      
      # Memory optimization
      - key: PYTHONUNBUFFERED
        value: "1"
      - key: MALLOC_TRIM_THRESHOLD_
        value: "100000"
    
    # Auto-deploy
    autoDeploy: true
    
    # Persistent disk (jobs survive restarts)
    disk:
      name: pdf-temp
      mountPath: /app/uploads
      sizeGB: 1